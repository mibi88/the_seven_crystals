#include <mapgen.h>

#include <math.h>

int is_generated(Level *level, int x, int y) {
    if(x >= 0 && x < LEVEL_W && y >= 0 && y < LEVEL_H) {
        return level->data[y*LEVEL_W+x].generated;
    }
    return 0;
}

void generate_nearby_rooms(Level *level, Room room, int x, int y, Room *rooms,
                           int n) {
    int i, p, c, selected;
    if(room.left && !is_generated(level, x-1, y)){
        c = 0;
        for(i=0;i<n;i++){
            if(rooms[i].right){
                c++;
            }
        }
        p=0;
        selected = rand()%c;
        for(i=0;i<selected;i++){
            do{
                p++;
            }while(!rooms[p].right);
        }
        if(x-1 >= 0){
            level->data[y*LEVEL_W+x-1] = rooms[p];
            generate_nearby_rooms(level, rooms[p], x-1, y, rooms, n);
        }
    }
    if(room.right && !is_generated(level, x+1, y)){
        c = 0;
        for(i=0;i<n;i++){
            if(rooms[i].left){
                c++;
            }
        }
        p=0;
        selected = rand()%c;
        for(i=0;i<selected;i++){
            do{
                p++;
            }while(!rooms[p].left);
        }
        if(x+1 < LEVEL_W){
            level->data[y*LEVEL_W+x+1] = rooms[p];
            generate_nearby_rooms(level, rooms[p], x+1, y, rooms, n);
        }
    }
    if(room.up && !is_generated(level, x, y-1)){
        c = 0;
        for(i=0;i<n;i++){
            if(rooms[i].down){
                c++;
            }
        }
        p=0;
        selected = rand()%c;
        for(i=0;i<selected;i++){
            do{
                p++;
            }while(!rooms[p].down);
        }
        if(y-1 >= 0){
            level->data[(y-1)*LEVEL_W+x] = rooms[p];
            generate_nearby_rooms(level, rooms[p], x, y-1, rooms, n);
        }
    }
    if(room.down && !is_generated(level, x, y+1)){
        c = 0;
        for(i=0;i<n;i++){
            if(rooms[i].up){
                c++;
            }
        }
        p=0;
        selected = rand()%c;
        for(i=0;i<selected;i++){
            do{
                p++;
            }while(!rooms[p].up);
        }
        if(y+1 < LEVEL_H){
            level->data[(y+1)*LEVEL_W+x] = rooms[p];
            generate_nearby_rooms(level, rooms[p], x, y+1, rooms, n);
        }
    }
}

void generate_level(Level *level, int seed, Room *rooms, Room start, int x,
                    int y, int n) {
    int i;
    for(i=0;i<LEVEL_W*LEVEL_H;i++){
        level->data[i].generated = 0;
    }
    srand(seed);
    
    level->data[y*LEVEL_W+x] = start;
    if(n > 0){
        generate_nearby_rooms(level, start, x, y, rooms, n);
    }
}

void generate_level_tilemap(Level *level) {
    int gx, gy;
    int x, y;
    Room *room;
    unsigned char c;
    
    for(gy=0;gy<LEVEL_H;gy++){
        for(gx=0;gx<LEVEL_W;gx++){
            room = &level->data[gy*LEVEL_W+gx];
            if(!room->generated){
                puts("[WARNING] Room not generated!");
            }
            for(y=0;y<ROOM_H;y++){
                for(x=0;x<ROOM_W;x++){
                    if(room->generated){
                        c = room->data[y*ROOM_W+x];
                    }else{
                        c = 1;
                    }
                    if(gx*ROOM_W+x == 0 || gx*ROOM_W+x == LEVEL_W*ROOM_W-1 ||
                       gy*ROOM_H+y == 0 || gy*ROOM_H+y == LEVEL_H*ROOM_H-1){
                        c = 0;
                    }
                    level->tiles[(gy*ROOM_H+y)*(LEVEL_W*ROOM_W)+(gx*ROOM_W+x)] =
                            c;
                }
            }
        }
    }
    level->tilemap.width = LEVEL_W*ROOM_W;
    level->tilemap.height = LEVEL_H*ROOM_H;
    level->tilemap.data = level->tiles;
}

const unsigned char light_tiles[LIGHT_TILES] = {10, 11, 12};
const unsigned char light_strength[LIGHT_TILES] = {5, 6, 6};

void generate_level_lighting(Level *level){
    int x, y, i;
    IntVector lights[LEVEL_W*ROOM_W*LEVEL_H*ROOM_H];
    unsigned char strength[LEVEL_W*ROOM_W*LEVEL_H*ROOM_H];
    int light_num = 0;
    float brightness;
    float distance;
    for(y=0;y<LEVEL_H*ROOM_H;y++){
        for(x=0;x<LEVEL_W*ROOM_W;x++){
            for(i=0;i<LIGHT_TILES;i++){
                if(level->tiles[y*(LEVEL_W*ROOM_W)+x] == light_tiles[i]){
                    lights[light_num].x = x;
                    lights[light_num].y = y;
                    strength[light_num] = light_strength[i];
                    light_num++;
                }
            }
        }
    }
    
    for(y=0;y<LEVEL_H*ROOM_H;y++){
        for(x=0;x<LEVEL_W*ROOM_W;x++){
            brightness = 0.0;
            for(i=0;i<light_num;i++){
                distance = sqrt((x-lights[i].x)*(x-lights[i].x)+
                                (y-lights[i].y)*(y-lights[i].y));
                if(distance > strength[i]){
                    distance = strength[i];
                }
                if(distance < 1){
                    distance = 1;
                }
                brightness += strength[i]-distance;
            }
            if(brightness >= LIGHT_LEVELS){
                brightness = LIGHT_LEVELS-1;
            }
            level->light[y*(LEVEL_W*ROOM_W)+x] = 255.0/LIGHT_LEVELS*
                                                 brightness;
        }
    }
    level->tilemap.light = level->light;
}

/* Data */

/* Level 1 */
const Room floor_vertical1 = {
    1,
    1, 1, 1, 1,
    {
        0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0,
        0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0,
        0, 0, 0, 0, 10, 1, 1, 1, 1, 1, 1, 10, 0, 0, 0, 0,
        0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0,
        0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0,
        0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0,
        7, 2, 7, 7, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0,
        0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0,
        0, 0, 0, 0, 10, 1, 1, 1, 1, 1, 1, 10, 0, 0, 0, 0,
        0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0,
        0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 7, 2, 7, 7,
        0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0,
        0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0,
        0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0,
        0, 0, 0, 0, 10, 1, 1, 1, 1, 1, 1, 10, 0, 0, 0, 0,
        0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0
    }
};

const Room floor_horizontal1 = {
    1,
    1, 1, 1, 1,
    {
        0, 0, 0, 0, 0, 7, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 7, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 7, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        1, 1, 1, 10, 1, 1, 1, 1, 1, 10, 1, 1, 1, 1, 1, 10,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 10, 1, 1, 1, 1, 1, 10, 1, 1, 1, 1, 1, 10,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 7, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 7, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 7, 0, 0, 0, 0, 0, 0
    }
};

const Room spawn_single1 = {
    1,
    1, 1, 1, 1,
    {
        0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0,
        0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0,
        0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0,
        0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 2, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0,
        0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0,
        0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0,
        0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0
    }
};

const Room spawn_double1 = {
    1,
    1, 1, 1, 1,
    {
        0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0,
        0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0,
        0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0,
        0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0,
        0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0,
        0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0,
        0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0
    }
};

const Room spawn_hidden1 = {
    1,
    1, 1, 1, 1,
    {
        0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0,
        0, 2, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 2, 0,
        0, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0,
        0, 0, 1, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0,
        1, 0, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1,
        1, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0,
        1, 1, 1, 1, 1, 1, 1, 0, 1, 0, 1, 0, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 0, 1, 0, 1, 0, 1, 1, 1, 1,
        1, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 1, 1, 1, 1,
        1, 0, 2, 1, 1, 1, 1, 0, 1, 0, 1, 0, 1, 1, 1, 1,
        1, 0, 1, 1, 1, 1, 1, 0, 1, 0, 1, 0, 1, 1, 1, 1,
        0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 2, 0, 1, 1, 1, 1,
        0, 1, 1, 1, 2, 0, 1, 0, 1, 0, 0, 0, 1, 1, 1, 0,
        0, 1, 0, 0, 0, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 0,
        0, 1, 1, 1, 2, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0
    }
};

const Room end_room1 = {
    1,
    1, 1, 1, 1,
    {
        0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0,
        0, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 5, 5, 2, 0,
        0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 5, 5, 1, 0,
        0, 1, 1, 1, 1, 1, 5, 5, 5, 5, 5, 5, 5, 5, 1, 0,
        1, 1, 1, 1, 1, 1, 5, 5, 5, 5, 5, 5, 5, 5, 1, 1,
        1, 1, 5, 5, 5, 5, 5, 5, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 5, 5, 5, 5, 5, 5, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 5, 5, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 5, 5, 1, 1, 1, 2, 2, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 5, 5, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 5, 5, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 5, 5, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        0, 1, 5, 5, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0,
        0, 1, 5, 5, 1, 1, 1, 1, 1, 1, 1, 1, 1, 3, 1, 0,
        0, 2, 5, 5, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 0,
        0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0
    }
};

Room level1[5] = {
    floor_vertical1,
    floor_horizontal1,
    spawn_single1,
    spawn_double1,
    spawn_hidden1
};
/* Level 2-4 */
const Room floor_vertical2 = {
    1,
    1, 1, 1, 1,
    {
        0, 0, 0, 0, 1, 1, 1, 5, 5, 1, 1, 1, 0, 0, 0, 0,
        0, 0, 0, 0, 1, 1, 1, 5, 5, 1, 7, 1, 0, 0, 0, 0,
        0, 0, 0, 0, 10, 1, 1, 5, 5, 7, 1, 10, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 1, 1, 5, 5, 5, 1, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 2, 0, 1, 5, 5, 1, 0, 2, 0, 0, 0, 0,
        7, 7, 2, 7, 1, 1, 1, 5, 5, 1, 1, 1, 0, 0, 0, 0,
        0, 0, 0, 0, 1, 1, 5, 5, 5, 1, 1, 1, 0, 0, 0, 0,
        0, 0, 0, 0, 10, 1, 7, 5, 5, 1, 1, 10, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 1, 1, 5, 5, 1, 1, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 2, 0, 1, 5, 5, 1, 0, 2, 0, 0, 0, 0,
        0, 0, 0, 0, 1, 1, 1, 5, 5, 1, 1, 1, 7, 7, 2, 7,
        0, 0, 0, 0, 1, 1, 1, 5, 5, 7, 1, 1, 0, 0, 0, 0,
        0, 0, 0, 0, 10, 1, 1, 5, 5, 5, 1, 10, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 1, 1, 5, 5, 1, 1, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 2, 0, 1, 5, 5, 1, 0, 2, 0, 0, 0, 0,
        0, 0, 0, 0, 1, 1, 1, 5, 5, 1, 1, 1, 0, 0, 0, 0
    }
};

const Room floor_horizontal2 = {
    1,
    1, 1, 1, 1,
    {
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 7, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 7, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 7, 0, 0, 0, 0,
        1, 1, 10, 0, 2, 1, 1, 10, 0, 2, 1, 1, 10, 0, 2, 1,
        1, 1, 1, 1, 0, 1, 1, 1, 1, 0, 1, 1, 1, 1, 0, 1,
        1, 1, 1, 1, 5, 1, 1, 1, 1, 1, 1, 7, 1, 5, 1, 1,
        5, 5, 7, 5, 5, 5, 7, 5, 5, 5, 5, 5, 5, 5, 5, 5,
        5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5,
        1, 1, 1, 1, 7, 1, 1, 7, 1, 5, 1, 1, 1, 7, 1, 1,
        1, 1, 1, 1, 0, 1, 1, 1, 1, 0, 1, 1, 1, 1, 0, 1,
        1, 1, 10, 0, 2, 1, 1, 10, 0, 2, 1, 1, 10, 0, 2, 1,
        0, 0, 0, 0, 0, 0, 7, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 7, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 7, 0, 0, 0, 0, 0, 0, 0, 0, 0
    }
};

const Room spawn_single2 = {
    1,
    1, 1, 1, 1,
    {
        0, 0, 0, 0, 1, 1, 1, 5, 5, 1, 1, 1, 0, 0, 0, 0,
        0, 1, 1, 1, 1, 1, 1, 1, 5, 1, 1, 1, 1, 1, 1, 0,
        0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0,
        0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 7, 1, 1, 1, 0,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 7, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        5, 1, 1, 7, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 5,
        5, 5, 5, 1, 1, 1, 0, 2, 0, 1, 1, 1, 1, 5, 5, 5,
        1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 7, 5, 5, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 5, 5, 5, 5, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 5, 5, 5, 5, 1, 1,
        0, 1, 1, 1, 1, 1, 1, 1, 7, 1, 5, 5, 1, 1, 1, 0,
        0, 1, 1, 1, 1, 1, 1, 1, 1, 5, 5, 1, 1, 1, 1, 0,
        0, 1, 1, 1, 1, 1, 1, 1, 5, 5, 1, 1, 1, 1, 1, 0,
        0, 0, 0, 0, 1, 1, 1, 5, 5, 1, 1, 1, 0, 0, 0, 0
    }
};

const Room spawn_double2 = {
    1,
    1, 1, 1, 1,
    {
        0, 0, 0, 0, 1, 1, 1, 5, 5, 1, 1, 1, 0, 0, 0, 0,
        0, 1, 1, 1, 1, 1, 1, 5, 1, 1, 1, 1, 1, 1, 1, 0,
        0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0,
        0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        5, 1, 1, 1, 1, 0, 0, 7, 0, 0, 1, 1, 1, 1, 1, 5,
        1, 1, 1, 1, 0, 2, 1, 1, 1, 2, 0, 1, 1, 1, 5, 5,
        1, 1, 1, 1, 1, 0, 0, 7, 0, 0, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0,
        0, 1, 1, 1, 1, 1, 1, 1, 5, 1, 1, 1, 1, 1, 1, 0,
        0, 1, 1, 1, 1, 1, 1, 5, 5, 1, 1, 1, 1, 1, 1, 0,
        0, 0, 0, 0, 1, 1, 1, 5, 5, 1, 1, 1, 0, 0, 0, 0
    }
};

const Room spawn_hidden2 = {
    1,
    1, 1, 1, 1,
    {
        0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0,
        0, 2, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 2, 0,
        0, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0,
        0, 0, 1, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0,
        1, 0, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1,
        1, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0,
        1, 1, 1, 1, 1, 1, 1, 0, 1, 0, 1, 0, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 0, 1, 0, 1, 0, 1, 1, 1, 1,
        1, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 1, 1, 1, 1,
        1, 0, 2, 1, 1, 1, 1, 0, 1, 0, 1, 0, 1, 1, 1, 1,
        1, 0, 1, 1, 1, 1, 1, 0, 1, 0, 1, 0, 1, 1, 1, 1,
        0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 2, 0, 1, 1, 1, 1,
        0, 1, 1, 1, 2, 0, 1, 0, 1, 0, 0, 0, 1, 1, 1, 0,
        0, 1, 0, 0, 0, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 0,
        0, 1, 1, 1, 2, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0
    }
};

const Room end_room2 = {
    1,
    1, 1, 1, 1,
    {
        0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0,
        0, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 5, 5, 2, 0,
        0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 5, 5, 1, 0,
        0, 1, 1, 1, 1, 1, 5, 5, 5, 5, 5, 5, 5, 5, 1, 0,
        1, 1, 1, 1, 1, 1, 5, 5, 5, 5, 5, 5, 5, 5, 1, 1,
        1, 1, 5, 5, 5, 5, 5, 5, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 5, 5, 5, 5, 5, 5, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 5, 5, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 5, 5, 1, 1, 1, 2, 2, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 5, 5, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 5, 5, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 5, 5, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        0, 1, 5, 5, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0,
        0, 1, 5, 5, 1, 1, 1, 1, 1, 1, 1, 1, 1, 3, 1, 0,
        0, 2, 5, 5, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 0,
        0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0
    }
};

const Room boss_room = {
    1,
    1, 1, 1, 1,
    {
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0,
        0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0,
        0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 7,
        0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0,
        0, 1, 1, 1, 8, 1, 1, 8, 1, 1, 1, 8, 1, 1, 1, 0,
        0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0,
        0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0,
        0, 1, 1, 1, 1, 1, 8, 1, 8, 1, 1, 1, 1, 1, 1, 0,
        0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 7,
        0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 7,
        0, 1, 1, 1, 8, 1, 1, 1, 1, 1, 1, 8, 1, 1, 1, 0,
        0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0,
        0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0,
        0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0,
        0, 0, 0, 0, 7, 0, 7, 0, 0, 0, 0, 7, 0, 7, 7, 0
    }
};

Room level2[5] = {
    floor_vertical2,
    floor_horizontal2,
    spawn_single2,
    spawn_double2,
    spawn_hidden2
};

/* Level 5-7 */
const Room floor_vertical3 = {
    1,
    0, 0, 1, 1,
    {
        5, 5, 5, 5, 1, 1, 1, 1, 1, 1, 1, 1, 5, 5, 5, 5,
        5, 5, 5, 5, 1, 1, 1, 1, 1, 5, 7, 1, 5, 5, 5, 5,
        5, 5, 5, 0, 11, 1, 1, 1, 1, 7, 1, 12, 0, 5, 5, 5,
        5, 5, 5, 5, 0, 1, 1, 1, 1, 5, 1, 0, 5, 5, 5, 5,
        5, 5, 5, 5, 2, 0, 5, 1, 1, 1, 0, 2, 5, 5, 5, 5,
        5, 5, 5, 5, 1, 1, 1, 1, 1, 1, 1, 1, 5, 5, 5, 5,
        5, 5, 5, 5, 1, 1, 1, 1, 1, 1, 1, 1, 5, 5, 5, 5,
        5, 5, 5, 0, 11, 1, 7, 1, 1, 1, 1, 12, 0, 5, 5, 5,
        5, 5, 5, 5, 0, 1, 1, 1, 1, 1, 1, 0, 5, 5, 5, 5,
        5, 5, 5, 5, 2, 0, 1, 1, 1, 1, 0, 2, 5, 5, 5, 5,
        5, 5, 5, 5, 1, 1, 1, 1, 1, 1, 1, 1, 5, 5, 5, 5,
        5, 5, 5, 5, 1, 1, 1, 1, 1, 7, 1, 1, 5, 5, 5, 5,
        5, 5, 5, 0, 11, 1, 1, 1, 1, 1, 1, 12, 0, 5, 5, 5,
        5, 5, 5, 5, 0, 1, 1, 1, 1, 5, 1, 0, 5, 5, 5, 5,
        5, 5, 5, 5, 2, 0, 1, 1, 1, 1, 0, 2, 5, 5, 5, 5,
        5, 5, 5, 5, 1, 1, 1, 1, 1, 1, 1, 1, 5, 5, 5, 5
    }
};

const Room floor_horizontal3 = {
    1,
    0, 0, 1, 1,
    {
        5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5,
        5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5,
        5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5,
        5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5,
        1, 1, 12, 0, 2, 1, 1, 12, 0, 2, 1, 1, 12, 0, 2, 1,
        1, 1, 1, 1, 0, 1, 5, 1, 1, 0, 1, 1, 1, 1, 0, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 7, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 7, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1,
        1, 1, 1, 1, 7, 1, 1, 7, 1, 5, 1, 1, 1, 7, 1, 1,
        1, 1, 1, 1, 0, 1, 1, 1, 1, 0, 1, 1, 1, 1, 0, 1,
        1, 1, 12, 0, 2, 1, 1, 12, 0, 2, 1, 1, 12, 0, 2, 1,
        5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5,
        5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5,
        5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5,
        5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5
    }
};

const Room down3 = {
    1,
    0, 0, 1, 0,
    {
        5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5,
        5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5,
        5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5,
        5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5,
        5, 5, 5, 5, 2, 1, 1, 12, 0, 2, 1, 1, 12, 0, 2, 1,
        5, 5, 5, 5, 0, 1, 5, 1, 1, 0, 1, 1, 1, 1, 0, 1,
        5, 5, 5, 5, 1, 1, 1, 1, 1, 1, 1, 7, 1, 1, 1, 1,
        5, 5, 5, 5, 1, 1, 7, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        5, 5, 5, 5, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1,
        5, 5, 5, 5, 7, 1, 1, 7, 1, 5, 1, 1, 1, 7, 1, 1,
        5, 5, 5, 5, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1,
        5, 5, 5, 5, 2, 1, 1, 10, 1, 2, 1, 1, 12, 0, 2, 1,
        5, 5, 5, 5, 1, 1, 1, 1, 1, 1, 1, 1, 5, 5, 5, 5,
        5, 5, 5, 5, 5, 1, 1, 1, 1, 1, 1, 1, 5, 5, 5, 5,
        5, 5, 5, 5, 5, 1, 1, 1, 1, 1, 1, 1, 5, 5, 5, 5,
        5, 5, 5, 5, 5, 1, 1, 1, 1, 1, 1, 1, 5, 5, 5, 5
    }
};

const Room t3 = {
    1,
    0, 0, 1, 0,
    {
        5, 5, 5, 5, 1, 1, 1, 1, 1, 1, 1, 1, 5, 5, 5, 5,
        5, 5, 5, 5, 5, 1, 1, 1, 1, 1, 1, 1, 5, 5, 5, 5,
        5, 5, 5, 5, 5, 1, 1, 1, 1, 1, 1, 1, 5, 5, 5, 5,
        5, 5, 5, 5, 5, 1, 1, 1, 1, 1, 1, 1, 5, 5, 5, 5,
        5, 5, 5, 5, 2, 1, 1, 1, 1, 2, 1, 1, 12, 0, 2, 1,
        5, 5, 5, 5, 0, 1, 5, 1, 1, 1, 1, 1, 1, 1, 0, 1,
        5, 5, 5, 5, 1, 1, 1, 1, 1, 1, 1, 7, 1, 1, 1, 1,
        5, 5, 5, 5, 1, 1, 7, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        5, 5, 5, 5, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1,
        5, 5, 5, 5, 7, 1, 1, 7, 1, 5, 1, 1, 1, 7, 1, 1,
        5, 5, 5, 5, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1,
        5, 5, 5, 5, 2, 1, 1, 10, 1, 2, 1, 1, 12, 0, 2, 1,
        5, 5, 5, 5, 1, 1, 1, 1, 1, 1, 1, 1, 5, 5, 5, 5,
        5, 5, 5, 5, 5, 1, 1, 1, 1, 1, 1, 1, 5, 5, 5, 5,
        5, 5, 5, 5, 5, 1, 1, 1, 1, 1, 1, 1, 5, 5, 5, 5,
        5, 5, 5, 5, 5, 1, 1, 1, 1, 1, 1, 1, 5, 5, 5, 5
    }
};

const Room spawn_single3 = {
    1,
    1, 1, 1, 1,
    {
        0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0,
        0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0,
        0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0,
        0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 7, 1, 1, 1, 0,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 7, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 7, 1, 1, 1, 10, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 10, 2, 10, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 10, 1, 1, 1, 1, 7, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        0, 1, 1, 1, 1, 1, 1, 1, 7, 1, 1, 1, 1, 1, 1, 0,
        0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0,
        0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0,
        0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0
    }
};

const Room spawn_double3 = {
    1,
    1, 1, 1, 1,
    {
        0, 0, 0, 0, 1, 1, 1, 5, 5, 1, 1, 1, 0, 0, 0, 0,
        0, 1, 1, 1, 1, 1, 1, 5, 1, 1, 1, 1, 1, 1, 1, 0,
        0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0,
        0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 10, 1, 1, 0,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 10, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        5, 1, 1, 1, 1, 0, 0, 5, 0, 0, 1, 1, 1, 1, 1, 5,
        1, 1, 1, 1, 0, 2, 5, 5, 5, 2, 0, 1, 1, 1, 5, 5,
        1, 1, 1, 1, 1, 0, 0, 5, 0, 0, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 10, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0,
        0, 1, 1, 1, 1, 1, 1, 1, 5, 1, 1, 1, 1, 1, 1, 0,
        0, 1, 1, 1, 1, 1, 1, 5, 5, 1, 1, 1, 1, 1, 10, 0,
        0, 0, 0, 0, 1, 1, 1, 5, 5, 1, 1, 1, 0, 0, 0, 0
    }
};

const Room spawn_hidden3 = {
    1,
    1, 1, 1, 1,
    {
        0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0,
        0, 2, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 2, 0,
        0, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0,
        0, 0, 1, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0,
        1, 0, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1,
        1, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0,
        1, 1, 1, 1, 1, 1, 1, 0, 1, 0, 1, 0, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 0, 1, 0, 1, 0, 0, 0, 0, 1,
        1, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1, 1, 1, 2, 0, 1,
        1, 0, 2, 1, 1, 1, 1, 0, 1, 0, 1, 0, 0, 0, 0, 1,
        1, 0, 1, 1, 1, 1, 1, 0, 1, 0, 1, 0, 1, 1, 1, 1,
        0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 2, 0, 1, 1, 1, 1,
        0, 1, 1, 1, 2, 0, 1, 0, 1, 0, 0, 0, 1, 1, 1, 0,
        0, 1, 0, 0, 0, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 0,
        0, 1, 1, 1, 2, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0
    }
};

const Room end_room3 = {
    1,
    1, 1, 1, 1,
    {
        0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 5, 5, 0, 0,
        0, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 5, 5, 2, 0,
        0, 11, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 5, 5, 12, 0,
        0, 1, 1, 1, 1, 1, 5, 5, 5, 5, 5, 5, 5, 5, 1, 0,
        1, 1, 1, 1, 1, 1, 5, 5, 5, 5, 5, 5, 5, 5, 1, 1,
        1, 1, 5, 5, 5, 5, 5, 5, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 5, 5, 5, 5, 5, 5, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 5, 5, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 5, 5, 1, 1, 1, 2, 2, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 5, 5, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 5, 5, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 5, 5, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        0, 1, 5, 5, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0,
        0, 11, 5, 5, 1, 1, 1, 1, 1, 1, 1, 1, 1, 3, 12, 0,
        0, 2, 5, 5, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 0,
        0, 0, 5, 5, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0
    }
};

Room level3[7] = {
    floor_vertical3,
    floor_horizontal3,
    spawn_single3,
    spawn_double3,
    spawn_hidden3,
    down3,
    t3
};

void generate_dungeon(Dungeon *dungeon, int seed) {
    int i;
    srand(seed);
    
    /* TODO: Use a loop */
    
    generate_level(&dungeon->levels[0], seed, level1, end_room1, rand()%LEVEL_W,
                   rand()%LEVEL_H, 5);
    generate_level(&dungeon->levels[1], seed, level2, end_room2, rand()%LEVEL_W,
                   rand()%LEVEL_H, 5);
    generate_level(&dungeon->levels[2], seed, level2, end_room2, rand()%LEVEL_W,
                   rand()%LEVEL_H, 5);
    generate_level(&dungeon->levels[3], seed, level2, end_room2, rand()%LEVEL_W,
                   rand()%LEVEL_H, 5);
    generate_level(&dungeon->levels[4], seed, level3, end_room3, rand()%LEVEL_W,
                   rand()%LEVEL_H, 7);
    generate_level(&dungeon->levels[5], seed, level3, end_room3, rand()%LEVEL_W,
                   rand()%LEVEL_H, 7);
    generate_level(&dungeon->levels[6], seed, level3, end_room3, rand()%LEVEL_W,
                   rand()%LEVEL_H, 7);
    generate_level(&dungeon->levels[7], seed, NULL, boss_room, 0, 0, 0);
    
    for(i=0;i<DUNGEON_SZ;i++){
        generate_level_tilemap(&dungeon->levels[i]);
        generate_level_lighting(&dungeon->levels[i]);
    }
}
